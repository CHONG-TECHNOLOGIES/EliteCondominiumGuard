-- Enable Row Level Security
ALTER TABLE public.restaurants ENABLE ROW LEVEL SECURITY;

-- Add RLS policies (adjust based on your auth setup)
CREATE POLICY "Enable read access for authenticated users" ON public.restaurants
  FOR SELECT
  USING (auth.role() = 'authenticated');

CREATE POLICY "Enable insert for authenticated users" ON public.restaurants
  FOR INSERT
  WITH CHECK (auth.role() = 'authenticated');

CREATE POLICY "Enable update for authenticated users" ON public.restaurants
  FOR UPDATE
  USING (auth.role() = 'authenticated');
```

-- Enable Row Level Security
ALTER TABLE public.sports ENABLE ROW LEVEL SECURITY;

-- Add RLS policies (adjust based on your auth setup)
CREATE POLICY "Enable read access for authenticated users" ON public.sports
  FOR SELECT
  USING (auth.role() = 'authenticated');

CREATE POLICY "Enable insert for authenticated users" ON public.sports
  FOR INSERT
  WITH CHECK (auth.role() = 'authenticated');

CREATE POLICY "Enable update for authenticated users" ON public.sports
  FOR UPDATE
  USING (auth.role() = 'authenticated');
```

-- Allow read access to authenticated users
CREATE POLICY "Allow read access for authenticated users" ON public.streets
    FOR SELECT TO authenticated USING (true);

-- Allow write access to admins (assuming admin role check logic exists or open for now based on app logic)
-- Adjust this policy based on your specific RLS requirements
CREATE POLICY "Allow write access for authenticated users" ON public.streets
    FOR ALL TO authenticated USING (true);



-- Grant execute permission to authenticated users
GRANT EXECUTE ON FUNCTION admin_get_all_visits TO authenticated;

-- Grant execute permission to authenticated users
GRANT EXECUTE ON FUNCTION admin_get_all_incidents TO authenticated;

-- Grant execute permission to authenticated users
GRANT EXECUTE ON FUNCTION admin_get_all_units TO authenticated;

-- Grant execute permission to authenticated users
GRANT EXECUTE ON FUNCTION admin_get_all_staff TO authenticated;

-- Grant execute permission to authenticated users
GRANT EXECUTE ON FUNCTION admin_get_dashboard_stats TO authenticated;




GRANT EXECUTE ON FUNCTION create_notification TO authenticated;

GRANT EXECUTE ON FUNCTION get_resident_notifications TO authenticated;

GRANT EXECUTE ON FUNCTION mark_notification_read TO authenticated;

GRANT EXECUTE ON FUNCTION mark_all_notifications_read TO authenticated;

GRANT EXECUTE ON FUNCTION get_unread_notification_count TO authenticated;


-- Enable RLS on notifications table
ALTER TABLE notifications ENABLE ROW LEVEL SECURITY;

-- Policy: Residents can only view their own notifications
CREATE POLICY "Residents can view their own notifications" ON notifications
  FOR SELECT
  TO authenticated
  USING (
    resident_id = auth.uid()::INT
  );

-- Policy: Allow authenticated users to insert notifications
CREATE POLICY "Allow authenticated to insert notifications" ON notifications
  FOR INSERT
  TO authenticated
  WITH CHECK (TRUE);

-- Policy: Residents can update their own notifications (mark as read)
CREATE POLICY "Residents can update their own notifications" ON notifications
  FOR UPDATE
  TO authenticated
  USING (resident_id = auth.uid()::INT);

